<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<title>Rock, Paper, Scissors Simulator</title>

		<style>
			html, body, div, span, applet, object, iframe,
			h1, h2, h3, h4, h5, h6, p, blockquote, pre,
			a, abbr, acronym, address, big, cite, code,
			del, dfn, em, img, ins, kbd, q, s, samp,
			small, strike, strong, sub, sup, tt, var,
			b, u, i, center,
			dl, dt, dd, ol, ul, li,
			fieldset, form, label, legend,
			table, caption, tbody, tfoot, thead, tr, th, td,
			article, aside, canvas, details, embed, 
			figure, figcaption, footer, header, hgroup, 
			menu, nav, output, ruby, section, summary,
			time, mark, audio, video {
				margin: 0;
				padding: 0;
				border: 0;
				font-size: 100%;
				font: inherit;
				vertical-align: baseline;
			}

			/* HTML5 display-role reset for older browsers */
			article, aside, details, figcaption, figure, 
			footer, header, hgroup, menu, nav, section {
				display: block;
			}

			body {
				line-height: 1;
			}

			ol, ul {
				list-style: none;
			}

			blockquote, q {
				quotes: none;
			}

			blockquote:before, blockquote:after,
			q:before, q:after {
				content: '';
				content: none;
			}

			table {
				border-collapse: collapse;
				border-spacing: 0;
			}

			#battleground {
				position: relative;
				font-family:segoe ui emoji;
				font-size:"3.5em";
				margin: 50px auto;
				width: 900px;
				height: 500px;
				border: 1px solid #000;
			}

			#battleground span {
				width: 20px;
				height: 20px;
				position: absolute;
			}
		</style>
	</head>

	<body>
		<h1>Rock, Paper, Scissors Simulator</h1>
		<div id="battleground"></div>
	</body>

	<script type="text/javascript">
		const battleground = document.getElementById('battleground');
		const battlegroundWidth = battleground.offsetWidth - 22;
		const battlegroundHeight = battleground.offsetHeight - 22;

		const fighterCount = 40;

		hasEnded = false;

		window.onload = function() {
			createSpanElements();

			var moveElements = setInterval(function() {
				if (!hasEnded) {
					chaseElements(".scissor", ".paper");
					chaseElements(".paper", ".rock");
					chaseElements(".rock", ".scissor");
				} else {
					clearInterval(moveElements);
				}
			}, 80);
		}

		function calculateDistance(elem1, elem2) {
    		const x1 = elem1.offsetLeft + elem1.offsetWidth / 2;
    		const y1 = elem1.offsetTop + elem1.offsetHeight / 2;
    		const x2 = elem2.offsetLeft + elem2.offsetWidth / 2;
    		const y2 = elem2.offsetTop + elem2.offsetHeight / 2;
    
    		const dx = x2 - x1;
    		const dy = y2 - y1;
    
    		return Math.sqrt(dx * dx + dy * dy);
		}


		function chaseElements(attacker, targeted) {
    		const chasers = document.querySelectorAll(attacker);
			const targets = document.querySelectorAll(targeted);

    		chasers.forEach(chaser => {
        		let nearestTarget = null;
        		let nearestDistance = Infinity;
        
        		targets.forEach(target => {
            		const distance = calculateDistance(chaser, target);
            		if (distance < nearestDistance) {
                		nearestDistance = distance;
                		nearestTarget = target;
            		}
        		});
        
        		if (nearestTarget) {
            		const chaserX = chaser.offsetLeft
            		const chaserY = chaser.offsetTop
            		const targetX = nearestTarget.offsetLeft;
            		const targetY = nearestTarget.offsetTop;
            		speed = 1;
            		if (chasers.length <= (fighterCount/3)/1.2) {
            			speed = 5;
            		}
            
            		if (chaserX !== targetX) {
        				chaser.style.left = chaserX + (chaserX < targetX ? speed : -speed) + getRandomPosition(-1, +2) + 'px';
            		}
            
            		if (chaserY !== targetY) {
                		chaser.style.top = chaserY + (chaserY < targetY ? speed : -speed) + getRandomPosition(-1, +2) + 'px';
            		}
        		}
    		});

    		checkTouchingElements()
		}

		function boundaryCheckY(yPos) {
			if (yPos > battlegroundHeight) {
					yPos = battlegroundHeight;
				}

			if (yPos < 0) {
				yPos = 0;
			}

			return yPos;
		}

		function boundaryCheckX(xPos) {
			if (xPos > battlegroundWidth) {
				xPos = battlegroundWidth;
			}

			if (xPos < 0) {
				xPos = 0;
			}

			return xPos;
		}

		function getRandomPosition(min, max) {
  			return Math.floor(Math.random() * (max - min) + min);
		}


		function checkCollision(x, y, elements) {
  			const rect1 = { left: x, right: x + 20, top: y, bottom: y + 20 };
  			for (const el of elements) {
    			const rect2 = el.getBoundingClientRect();
    			if (
				rect1.left < rect2.right &&
				rect1.right > rect2.left &&
				rect1.top < rect2.bottom &&
				rect1.bottom > rect2.top
    			) {
      				return true;
    			}
  			}
  			return false;
		}

		function createSpanElements(fighterType) {
  			const parentDiv = battleground;
  			const numElements = fighterCount * 3;
  			const maxAttempts = 100;
  			const spanElements = [];

			for (let i = 0; i < numElements; i++) {
				let xPos, yPos, attempts = 0;

				do {
					xPos = getRandomPosition(0, battlegroundWidth);
					yPos = getRandomPosition(0, battlegroundHeight);
					attempts++;

					if (attempts >= maxAttempts) {
						console.log("Could not find a suitable position for element", i);
						break;
					}
				} while (checkCollision(xPos, yPos, spanElements));

				const span = document.createElement("span");
				span.style.left = xPos + "px";
				span.style.top = yPos + "px";

				if (i % 3 === 0) {
					span.innerHTML = "âœ‚";
					span.className = "scissor";
				} else if (i % 3 === 1) {
					span.innerHTML = "ðŸŒ‘";
					span.className = "rock";
				} else {
					span.innerHTML = "ðŸ“œ";
					span.className = "paper";
				}

				spanElements.push(span);
				parentDiv.appendChild(span);
  			}
		}

		function moveElementsApart(element1, element2) {
    const distance = 2; // Adjust this value based on how much you want the elements to move apart
    const rect1 = element1.getBoundingClientRect();
    const rect2 = element2.getBoundingClientRect();
    
    const overlapX = Math.max(0, Math.min(rect1.right, rect2.right) - Math.max(rect1.left, rect2.left));
    const overlapY = Math.max(0, Math.min(rect1.bottom, rect2.bottom) - Math.max(rect1.top, rect2.top));
    
    if (overlapX > 0 && overlapY > 0) {
        if (rect1.left < rect2.left) {
            element1.style.left = `${parseInt(element1.style.left) - distance}px`;
            element2.style.left = `${parseInt(element2.style.left) + distance}px`;
        } else {
            element1.style.left = `${parseInt(element1.style.left) + distance}px`;
            element2.style.left = `${parseInt(element2.style.left) - distance}px`;
        }
        
        if (rect1.top < rect2.top) {
            element1.style.top = `${parseInt(element1.style.top) - distance}px`;
            element2.style.top = `${parseInt(element2.style.top) + distance}px`;
        } else {
            element1.style.top = `${parseInt(element1.style.top) + distance}px`;
            element2.style.top = `${parseInt(element2.style.top) - distance}px`;
        }
    }
}
		
		function areElementsTouching(elem1, elem2) {
	    	const rect1 = elem1.getBoundingClientRect();
	    	const rect2 = elem2.getBoundingClientRect();
	    
	    	const leftDistance = Math.abs(rect1.left - rect2.left);
	    	const topDistance = Math.abs(rect1.top - rect2.top);
	    
		    const horizontalTouch = leftDistance < 15; // Width of the elements
		    const verticalTouch = topDistance < 15; // Height of the elements
		    
		    return horizontalTouch && verticalTouch;
		}

		function checkTouchingElements() {
		    const spanElements = document.querySelectorAll('span');
		    
		    for (let i = 0; i < spanElements.length; i++) {
		        for (let j = i + 1; j < spanElements.length; j++) {
		            if (areElementsTouching(spanElements[i], spanElements[j])) {
		                //console.log("Elements are touching:", spanElements[i], spanElements[j]);

		            	moveElementsApart(spanElements[i], spanElements[j]);

		                if (spanElements[i].classList.contains("scissor") && spanElements[j].classList.contains("paper")) {
		                	spanElements[j].className = "scissor";
		                	spanElements[j].innerHTML = "âœ‚"
		                }

		                if (spanElements[i].classList.contains("rock") && spanElements[j].classList.contains("scissor")) {
		                	spanElements[j].className = "rock";
		                	spanElements[j].innerHTML = "ðŸŒ‘"
		                }

		                if (spanElements[i].classList.contains("paper") && spanElements[j].classList.contains("rock")) {
		                	spanElements[j].className = "paper";
		                	spanElements[j].innerHTML = "ðŸ“œ"
		                }

		                if (spanElements[j].classList.contains("scissor") && spanElements[i].classList.contains("paper")) {
		                	spanElements[i].className = "scissor";
		                	spanElements[i].innerHTML = "âœ‚"
		                }

		                if (spanElements[j].classList.contains("rock") && spanElements[i].classList.contains("scissor")) {
		                	spanElements[i].className = "rock";
		                	spanElements[i].innerHTML = "ðŸŒ‘"
		                }

		                if (spanElements[j].classList.contains("paper") && spanElements[i].classList.contains("rock")) {
		                	spanElements[i].className = "paper";
		                	spanElements[i].innerHTML = "ðŸ“œ"
		                }
										
		            }
		        }
		    }

		    checkWinner();
		}

		function checkWinner() {
			if (document.querySelectorAll('.scissor').length == fighterCount * 3) {
				if (!hasEnded) {
					alert("Scissors win!");
					hasEnded = true;
				}
			}

			if (document.querySelectorAll('.rock').length == fighterCount * 3) {
				if (!hasEnded) {
					alert("Rock win!");
					hasEnded = true;
				}
			}

			if (document.querySelectorAll('.paper').length == fighterCount * 3) {
				if (!hasEnded) {
					alert("Paper win!");
					hasEnded = true;
				}
			}
		}
		
	</script>
</html>